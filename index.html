<html>
<head>
    <title>Github Issues</title>
</head>
<body>
    <a href="#" id="login">Login</a>
    <br>
    <a href="#" id="getAuth">Show auth code</a>
    <p id="token"></p>
    <script>
    (function() {
      var tokenObj = {};
      document.getElementById('login').onclick = function() {
        var client_id = '2582beb06ed078ba0634';
        window.open('https://github.com/login/oauth/authorize?client_id=' + client_id);
      };
      document.getElementById('getAuth').onclick = function() {
        var authCode = getAuthCode(window.location.href);
        getJSON('http://localhost:9999/authenticate/' + authCode, setToken);

        function setToken() {
          tokenObj = JSON.parse(this.responseText);
          document.getElementById('token').innerHTML = tokenObj.token;
        }

        function getAuthCode(url){
          var error = url.match(/[&\?]error=([^&]+)/);
          if (error) {
            throw 'Error getting authorization code: ' + error[1];
          }
          return url.match(/[&\?]code=([\w\/\-]+)/)[1];
        }          

        function getJSON(url, cb) {
          var req = new XMLHttpRequest();
          req.addEventListener("load", cb);
          req.open("GET", url);
          req.send();
        }
      };
    }());
    </script>
</body>
</html>
